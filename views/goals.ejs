<h1>Goals</h1>

<form method="get" action="/goals" class="mb-2">
  <div class="flex gap-2">
    <div>
      <label>Student</label><br />
      <select name="studentId">
        <option value="">All students</option>
        <% students.forEach(function(s) { %>
          <option value="<%= s.id %>" <%= String(selectedStudentId) === String(s.id) ? 'selected' : '' %>>
            <%= s.firstName %> <%= s.lastName %>
          </option>
        <% }); %>
      </select>
    </div>
    <div>
      <label>Area</label><br />
      <select name="area">
        <option value="all" <%= selectedArea === 'all' ? 'selected' : '' %>>All</option>
        <option value="reading" <%= selectedArea === 'reading' ? 'selected' : '' %>>Reading</option>
        <option value="math" <%= selectedArea === 'math' ? 'selected' : '' %>>Math</option>
        <option value="writing" <%= selectedArea === 'writing' ? 'selected' : '' %>>Writing</option>
        <option value="behavior" <%= selectedArea === 'behavior' ? 'selected' : '' %>>Behavior</option>
        <option value="other" <%= selectedArea === 'other' ? 'selected' : '' %>>Other</option>
      </select>
    </div>
    <div class="flex items-end">
      <button type="submit" class="btn-secondary">Filter</button>
    </div>
  </div>
</form>

<form method="post" action="/goals/add" class="mb-3">
  <h3>Add Goal</h3>
  <div class="flex gap-2">
    <div style="flex:1">
      <label>Student</label><br />
      <select name="studentId" required>
        <option value="">Select student</option>
        <% students.forEach(function(s) { %>
          <option value="<%= s.id %>">
            <%= s.firstName %> <%= s.lastName %>
          </option>
        <% }); %>
      </select>
    </div>
    <div style="flex:1">
      <label>Area</label><br />
      <select name="area" required>
        <option value="">Select area</option>
        <option value="reading">Reading</option>
        <option value="math">Math</option>
        <option value="writing">Writing</option>
        <option value="behavior">Behavior</option>
        <option value="other">Other</option>
      </select>
    </div>
  </div>

  <div class="mt-1">
    <label>Description</label><br />
    <textarea name="description" rows="2" required></textarea>
  </div>

  <div class="flex gap-2 mt-1">
    <div style="flex:1">
      <label>Goal Grade Level</label><br />
      <input type="text" name="goalGradeLevel" placeholder="e.g., 2nd" required />
    </div>
    <div style="flex:1">
      <label>Mastery Criteria</label><br />
      <input type="text" name="masteryCriteria" placeholder="e.g., 80% across 3 sessions" required />
    </div>
  </div>

  <button type="submit" class="btn-primary mt-1">Save Goal</button>
</form>

<% if (!goals || goals.length === 0) { %>
  <p>No goals found. Add your first goal above.</p>
<% } else { %>
  <table>
    <thead>
      <tr>
        <th>Student</th>
        <th>Area</th>
        <th>Description</th>
        <th>Goal Grade</th>
        <th>Mastery Criteria</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% goals.forEach(function(g) { %>
        <tr>
          <td><%= g.studentName %></td>
          <td><%= g.area %></td>
          <td><%= g.description %></td>
          <td><%= g.goalGradeLevel %></td>
          <td><%= g.masteryCriteria %></td>
          <td>
            <form method="post"
                  action="/goals/<%= g.id %>/delete"
                  onsubmit="return confirm('Delete this goal and its assessment history?');">
              <button type="submit" class="btn-danger">Delete</button>
            </form>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>
<% } %>
