<h1>Student Report</h1>

<form method="get" action="/reports/student" class="mb-2">
  <label>Student</label><br />
  <select name="studentId" required onchange="this.form.submit()">
    <option value="">Select student</option>
    <% students.forEach(function(s) { %>
      <option value="<%= s.id %>" <%= selectedStudent && selectedStudent.id === s.id ? 'selected' : '' %>>
        <%= s.firstName %> <%= s.lastName %>
      </option>
    <% }); %>
  </select>
</form>

<% if (!selectedStudent) { %>
  <p>Select a student to view their report.</p>
<% } else { %>
  <section class="mb-2">
    <h3>Student info</h3>
    <p><strong><%= selectedStudent.firstName %> <%= selectedStudent.lastName %></strong></p>
    <p>Grade: <%= selectedStudent.gradeLevel %></p>
  </section>

  <section class="mb-2">
    <h3>Goals summary</h3>
    <% if (goalsSummary.length === 0) { %>
      <p>No assessment data yet for this student.</p>
    <% } else { %>
      <table>
        <thead>
          <tr>
            <th>Goal Description</th>
            <th>Area</th>
            <th>Latest % Correct</th>
            <th>Trend</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% goalsSummary.forEach(function(g) { %>
            <tr>
              <td><%= g.description %></td>
              <td><%= g.area %></td>
              <td><%= g.latestPercentCorrect == null ? 'No Data' : g.latestPercentCorrect.toFixed(1) + '%' %></td>
              <td><%= g.trend %></td>
              <td><%= g.status %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    <% } %>
  </section>

  <section class="mb-2">
    <h3>Fluency summary</h3>
    <% if (fluencySummary.length === 0) { %>
      <p>No fluency assessments recorded.</p>
    <% } else { %>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>WCPM</th>
            <th>Accuracy %</th>
            <th>Trend</th>
          </tr>
        </thead>
        <tbody>
          <% fluencySummary.forEach(function(f) { %>
            <tr>
              <td><%= f.date %></td>
              <td><%= f.wcpm %></td>
              <td><%= f.accuracyPercent.toFixed(1) %>%</td>
              <td><%= f.trend %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    <% } %>
  </section>
<% } %>

<div class="mt-2">
  <button class="btn-secondary" onclick="copyReport(); return false;">Copy Report Text</button>
</div>

<script>
function copyReport() {
  const text = document.body.innerText;
  navigator.clipboard.writeText(text).then(function () {
    alert("Report text copied to clipboard (whole page).");
  });
}
</script>
